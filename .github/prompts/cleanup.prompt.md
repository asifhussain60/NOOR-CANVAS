---

mode: agent
name: cleanup
alias: /cleanup
description: >
Perform a disciplined repo cleanup within an effective scope while preserving history,
enforcing naming conventions, consolidating docs, organizing Playwright assets, and
finishing with 0 uncommitted files. Align with NOOR-CANVAS-DESIGN, ncImplementationTracker.MD,
and Infrastructure-Fixes-Report for Playwright paths & ignores.

parameters:

- name: scope
  required: false
  description: Optional path or glob to limit work (e.g., "PlayWright/", "src/Web/\*\*").
  Defaults to repo root.

# ───────────────────────────

# 📖 Usage Examples

# ───────────────────────────

# 1) Clean the whole repo:

# /cleanup

#

# 2) Only tidy the Playwright area:

# /cleanup scope:"PlayWright/"

#

# 3) Focus on web UI code:

# /cleanup scope:"src/Web/\*\*"

# ───────────────────────────

# 🎯 Operating Mode

- Effective scope = {{scope}} if provided, otherwise repo root (".").
- All scans/moves/deletions/renames operate within the effective scope except:
  • Root-level .gitignore audit (always global)
  • Cross-scope link/rename fixes only when references cross in/out of scope

# 🧭 Goals

- Enforce clean structure + conventional filenames.
- Consolidate instructional Markdown to a single canonical README in-scope, linking back to root README when appropriate.
- Centralize Playwright tests/configs; ensure reports/results/artifacts are ignored (tracked vs ignored rules).
- Remove TEMP/artefacts, orphaned files, duplicates; update references after renames.
- Run formatters/linters on touched files; ensure build succeeds when scope touches buildable code.
- Conclude with: 0 uncommitted files (clean working tree).

# 📁 Structure & Naming Standards (Noor Canvas)

- PlayWright/
  - config/, tests/ → tracked
  - reports/, results/, artifacts/ → ignored (never tracked)
- Scripts/ and Scripts/Validation/
- IssueTracker/ with statuses: NOT STARTED, IN PROGRESS, AWAITING_CONFIRMATION, COMPLETED
- Documentation/ for deep docs; root README.md remains canonical
- Conventional names only (README.md, CONTRIBUTING.md, etc.); no "temp/new/final/fixed" style names.

# ⚖️ Constraints & Principles

- Prefer rename/move over delete to preserve history.
- Scope discipline: do not touch outside scope unless:
  • updating .gitignore,
  • fixing broken references across boundary,
  • untracking artefacts that should be ignored.
- Never change issue status or lifecycle; cleanup is non-destructive to tracker/state.

# 🧹 Workspace & Markdown Consolidation (NEW)

- Recursively analyze **all files and folders** under the **Noor Canvas folder** (repo root and SPA/NoorCanvas/\*\*).
- Move **all `*.md`/`*.MD` Markdown files** into **Workspaces/**, preserving logical subfolders:
  • Primary destination: `Workspaces/Documentation/`
  • Keep a single **root `README.md`** at repo root (canonical). Do not move `.github/**` docs, license headers, or policy files that must remain in place (e.g., `LICENSE`, `SECURITY.md`, `CODE_OF_CONDUCT.md`).
  • If a moved Markdown was referenced by relative links, update links to the new location.
- **Cleanup Workspaces/**
  • Deduplicate and merge overlapping docs (prefer the most recent & authoritative copy).
  • Collapse near-duplicates into one canonical doc; leave stubs that _link_ to the canonical if needed.
  • Remove obviously obsolete files (empty scaffolds, autogenerated dumps, stale screenshots) after verifying no references.
  • Normalize section headings and front-matter; add a table-of-contents to large docs.
- Produce a **Docs Map** in `Workspaces/Documentation/INDEX.md` listing all consolidated docs and their purpose.

# ➕ Additional Similar Cleanup Instructions (NEW)

- **Screenshot & Asset hygiene:** Move unreferenced images from scattered folders into `Workspaces/Assets/` or delete if unused; update links.
- **Code fences & formatting:** Auto-format Markdown (Prettier) and fix broken fences/indentation; ensure language tags (`ts, `csharp, ```powershell) where applicable.
- **Orphan detector:** Grep for references to moved files; if none, tag as orphan and remove or archive under `Workspaces/_Archive/` with date-stamped note.
- **Naming normalization:** Enforce kebab-case for file names in PlayWright/tests and PascalCase for C#/Razor; fix mixed-case folders.
- **README reduction:** If multiple READMEs exist in the same subtree, reduce to one canonical and convert others into section anchors or short “See: …” stubs.
- **Sample vs. prod config:** Move sample configs to `Workspaces/Samples/` and ensure `.env*` secrets are ignored and not committed.
- **Script garden:** Move ad-hoc helper scripts into `Scripts/` or `Scripts/Validation/`, add a one-line usage header, and mark experimental ones to `Workspaces/_Archive/` if deprecated.

# 📋 High-Level Plan (Execution Order)

0. Resolve Effective Scope
   - SCOPE = {{scope}} if provided; else "."

1. .gitignore Audit (GLOBAL)
   - Ensure idempotent rules for OS/editor junk, backups/caches/logs, build outputs, deps.
   - **Playwright**: confirm _ignored_ (reports/results/artifacts) and _tracked_ (config/tests) split is correct.
   - Show a short diff-style preview before applying.

2. Instructional Markdown Consolidation (Scoped)
   - Merge/normalize scattered instructions into one README in-scope.
   - Link to root README if scope is a sub-tree.
   - Remove duplicates/outdated copies.

3. **Markdown Sweep to Workspaces** (NEW)
   - Find all Markdown (`*.md`, `*.MD`) across Noor Canvas tree.
   - Exclusions: repo root `README.md`, `.github/**`, `LICENSE`, `SECURITY.md`, `CODE_OF_CONDUCT.md`.
   - Move to `Workspaces/Documentation/` maintaining relative sub-structure where helpful.
   - Update links/imports; generate `Workspaces/Documentation/INDEX.md`.

4. Naming & Link Fixes (Scoped)
   - Normalize file/folder case and conventional names.
   - Update internal links/imports/refs for any renames (fix cross-scope edges if necessary).

5. Duplicate/Orphan Pruning + Playwright Organization (Scoped)
   - Detect duplicates by hash/similarity; keep canonical copy.
   - Remove orphaned screenshots/assets not referenced.
   - Centralize Playwright tests under PlayWright/tests/ (if within scope); update configs accordingly.
   - Prune old artefact paths under scope.

6. Artefacts & Cache Cleanup (Scoped)
   - Remove build outputs, caches, logs, backups: bin/, obj/, dist/, .cache/, _.tmp, _.bak, \*.log
   - If any such paths are tracked, run `git rm -r --cached` to untrack (respecting .gitignore).

7. Lint & Format (Touched Files Only)
   - .NET: `dotnet format --verbosity minimal` from SPA/NoorCanvas/ when relevant
   - JS/TS/MD: `npx prettier --write .`
   - Fail run if fatal syntax/lint errors remain.

8. Build & Sanity Checks (If scope affects code)
   - For NOOR Canvas: `cd "d:\PROJECTS\NOOR CANVAS\SPA\NoorCanvas"; dotnet build`
   - Allow 1–2 warnings; require 0 errors.

9. Zero-Diff Finisher (Always End Clean)
   - Stage & commit intended changes: if scope set, `git add -A -- <SCOPE>` plus root-level edits (.gitignore/refs).
   - Untrack now-ignored artefacts with `git rm -r --cached`.
   - Purge ignored junk safely: `git clean -fdX`.
   - Re-verify: if `git status --porcelain` shows non-ignored junk, extend .gitignore or delete if disposable.
   - Use a conventional commit message, then push.
   - Assert: working tree is clean (0 uncommitted files).

# ✅ Post-Run Validation

- Git cleanliness: working tree empty.
- Playwright layout: tests/config tracked; artefacts ignored.
- **Docs Map present** at `Workspaces/Documentation/INDEX.md` and links verified.
- Build passes if scope included buildable code.
- Documentation: one canonical README in-scope; links valid.

# 🛡️ Regression Guards (Baked-In)

- [playwright] Enforce tracked/ignored split exactly; never commit reports/results/artifacts.
- [duplication] Detect & dedupe instructions; prefer canonical README + links (avoid repeating doctrine across prompts).
- [naming] Reject non-professional filenames; auto-normalize.
- [docs] Keep a single canonical root README; move all other Markdown to Workspaces/Documentation with link updates.
- [tracker] Do not alter issue statuses or infer completion.
- [evidence] Preview .gitignore changes before applying; record the final `git status` proof.

# 🔗 Documentation & Alignment Hooks

- Must align with NOOR-CANVAS-DESIGN.MD (architecture & phases).
- Must reflect ncImplementationTracker.MD (current state & lessons).
- Apply Playwright path/ignore rules from INFRASTRUCTURE-FIXES-REPORT.md (if present).
- If conflicts arise, prefer DESIGN → ImplementationTracker → Infrastructure Fixes, in that order.

# 🗒️ Summary Output (at end of run)

- 5–10 bullets of what changed & why.
- Table of renames/moves (old → new).
- List of deduped/removed files with reason.
- Final cleanliness proof: `git status` empty message.
