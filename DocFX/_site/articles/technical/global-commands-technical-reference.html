<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Global Commands Technical Reference | NOOR CANVAS Documentation </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Global Commands Technical Reference | NOOR CANVAS Documentation ">
    
    
      <link rel="shortcut icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.html">
      <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="NOOR CANVAS">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="global-commands-technical-reference">Global Commands Technical Reference</h1>

<h2 id="architecture-overview">Architecture Overview</h2>
<p>The NOOR Canvas global command system provides a unified PowerShell-based interface for development and administration tasks. Commands are implemented as PowerShell scripts with batch/cmd wrappers for cross-shell compatibility.</p>
<h2 id="implementation-details">Implementation Details</h2>
<h3 id="command-location">Command Location</h3>
<ul>
<li><strong>Base Directory</strong>: <code>D:\PROJECTS\NOOR CANVAS\Workspaces\Global\</code></li>
<li><strong>PowerShell Scripts</strong>: <code>*.ps1</code> files containing primary implementation</li>
<li><strong>Batch Wrappers</strong>: <code>*.bat</code> and <code>*.cmd</code> files for compatibility</li>
<li><strong>Global Access</strong>: Commands available system-wide through PowerShell profile loading</li>
</ul>
<h3 id="command-registration">Command Registration</h3>
<p>Commands are registered through the PowerShell profile system:</p>
<pre><code class="lang-powershell"># Profile loading mechanism (in Microsoft.PowerShell_profile.ps1)
$globalPath = &quot;D:\PROJECTS\NOOR CANVAS\Workspaces\Global&quot;
if (Test-Path $globalPath) {
    $env:PATH = &quot;$globalPath;$env:PATH&quot;
    Write-Host &quot;‚úÖ NOOR Canvas global commands loaded: nc, nct, ncdoc, iiskill&quot; -ForegroundColor Green
}
</code></pre>
<h2 id="nc-command-implementation">NC Command Implementation</h2>
<h3 id="core-script-ncps1">Core Script: <code>nc.ps1</code></h3>
<pre><code class="lang-powershell">[CmdletBinding()]
param(
    [switch]$SkipTokenGeneration,
    [switch]$Help
)

# Parameter validation and help display
if ($Help) {
    Write-Host &quot;NOOR Canvas Application Runner (NC Command)&quot; -ForegroundColor Green
    Write-Host &quot;Usage: nc [-SkipTokenGeneration] [-Help]&quot; -ForegroundColor Yellow
    Write-Host &quot;&quot;
    Write-Host &quot;Options:&quot; -ForegroundColor Cyan
    Write-Host &quot;  -SkipTokenGeneration    Skip the host token generation step&quot;
    Write-Host &quot;  -Help                   Display this help message&quot;
    return
}

# Workspace detection
$workspaceRoot = Split-Path -Parent (Split-Path -Parent $PSScriptRoot)
$projectPath = Join-Path $workspaceRoot &quot;SPA\NoorCanvas&quot;

# Token generation (unless skipped)
if (-not $SkipTokenGeneration) {
    Write-Host &quot;üîë Generating host tokens...&quot; -ForegroundColor Cyan
    &amp; &quot;$PSScriptRoot\nct.ps1&quot;
    if ($LASTEXITCODE -ne 0) {
        Write-Error &quot;‚ùå Token generation failed&quot;
        exit 1
    }
}

# Project build
Write-Host &quot;üî® Building NOOR Canvas...&quot; -ForegroundColor Cyan
Set-Location $projectPath
dotnet build --no-restore
if ($LASTEXITCODE -ne 0) {
    Write-Error &quot;‚ùå Build failed&quot;
    exit 1
}

# IIS Express launch
Write-Host &quot;üöÄ Starting IIS Express x64...&quot; -ForegroundColor Green
Start-Process -FilePath &quot;dotnet&quot; -ArgumentList &quot;run --urls `&quot;https://localhost:9091;http://localhost:9090`&quot;&quot; -NoNewWindow -Wait
</code></pre>
<h3 id="process-management">Process Management</h3>
<p>The NC command implements sophisticated process management:</p>
<ol>
<li><strong>Path Resolution</strong>: Automatically detects workspace structure using <code>Split-Path</code></li>
<li><strong>Error Handling</strong>: Validates each step with proper exit codes</li>
<li><strong>Build Integration</strong>: Ensures clean build before server start</li>
<li><strong>Port Management</strong>: Consistently uses ports 9091 (HTTPS) and 9090 (HTTP)</li>
</ol>
<h3 id="iis-express-integration">IIS Express Integration</h3>
<pre><code class="lang-powershell"># IIS Express configuration detection
$iisExpressPath = &quot;${env:ProgramFiles}\IIS Express\iisexpress.exe&quot;
if (Test-Path $iisExpressPath) {
    # Use IIS Express directly
    $arguments = &quot;/path:`&quot;$projectPath`&quot; /port:9091 /systray:false&quot;
    Start-Process -FilePath $iisExpressPath -ArgumentList $arguments
} else {
    # Fallback to dotnet run
    Start-Process -FilePath &quot;dotnet&quot; -ArgumentList &quot;run --urls `&quot;https://localhost:9091`&quot;&quot;
}
</code></pre>
<h2 id="nct-command-implementation">NCT Command Implementation</h2>
<h3 id="token-generation-algorithm">Token Generation Algorithm</h3>
<pre><code class="lang-powershell"># Cryptographically secure GUID generation
$hostToken = [System.Guid]::NewGuid().ToString()

# Database storage
$connectionString = &quot;Server=AHHOME;Database=KSESSIONS_DEV;User ID=sa;Password=adf4961glo;Connection Timeout=3600;TrustServerCertificate=True;Encrypt=False;&quot;

$query = @&quot;
INSERT INTO canvas.HostTokens (Id, Token, CreatedAt, ExpiresAt, IsActive)
VALUES (NEWID(), @Token, GETUTCDATE(), DATEADD(HOUR, 24, GETUTCDATE()), 1)
&quot;@

# SQL execution with proper parameterization
$connection = New-Object System.Data.SqlClient.SqlConnection($connectionString)
$command = New-Object System.Data.SqlClient.SqlCommand($query, $connection)
$command.Parameters.AddWithValue(&quot;@Token&quot;, $hostToken)
</code></pre>
<h3 id="security-considerations">Security Considerations</h3>
<ul>
<li><strong>GUID Generation</strong>: Uses cryptographically secure random number generator</li>
<li><strong>SQL Injection Prevention</strong>: All database queries use parameterized commands</li>
<li><strong>Token Expiration</strong>: Automatic 24-hour expiration for security</li>
<li><strong>Database Isolation</strong>: Uses dedicated development database (KSESSIONS_DEV)</li>
</ul>
<h2 id="ncdoc-command-implementation">NCDOC Command Implementation</h2>
<h3 id="docfx-integration">DocFX Integration</h3>
<pre><code class="lang-powershell"># DocFX build and serve
$docfxPath = Join-Path $workspaceRoot &quot;DocFX&quot;
Set-Location $docfxPath

# Build documentation
dotnet docfx docfx.json
if ($LASTEXITCODE -ne 0) {
    Write-Error &quot;‚ùå Documentation build failed&quot;
    exit 1
}

# Serve locally
dotnet docfx docfx.json --serve --port 8082
</code></pre>
<h3 id="browser-launch-logic">Browser Launch Logic</h3>
<pre><code class="lang-powershell"># Smart browser detection and launch
$documentationUrl = &quot;http://localhost:8082&quot;

if ($env:OS -eq &quot;Windows_NT&quot;) {
    Start-Process $documentationUrl
} else {
    # Cross-platform support
    if (Get-Command &quot;xdg-open&quot; -ErrorAction SilentlyContinue) {
        xdg-open $documentationUrl
    } elseif (Get-Command &quot;open&quot; -ErrorAction SilentlyContinue) {
        open $documentationUrl
    }
}
</code></pre>
<h2 id="iiskill-command-implementation">IISKILL Command Implementation</h2>
<h3 id="process-discovery">Process Discovery</h3>
<pre><code class="lang-powershell"># Find all IIS Express processes
$iisProcesses = Get-Process -Name &quot;iisexpress*&quot; -ErrorAction SilentlyContinue

if ($iisProcesses) {
    foreach ($process in $iisProcesses) {
        try {
            Write-Verbose &quot;Terminating IIS Express process: $($process.Id)&quot;
            Stop-Process -Id $process.Id -Force
            $processesKilled++
        }
        catch {
            Write-Warning &quot;Failed to stop process $($process.Id): $($_.Exception.Message)&quot;
        }
    }
}
</code></pre>
<h3 id="file-lock-management">File Lock Management</h3>
<pre><code class="lang-powershell"># Handle locked executable files
$lockedFiles = @(
    &quot;D:\PROJECTS\NOOR CANVAS\SPA\NoorCanvas\bin\Debug\net8.0\NoorCanvas.exe&quot;
)

foreach ($file in $lockedFiles) {
    if (Test-Path $file) {
        try {
            # Wait for file unlock
            $maxAttempts = 10
            $attempt = 0
            
            do {
                Start-Sleep -Milliseconds 500
                $attempt++
                $fileStream = $null
                
                try {
                    $fileStream = [System.IO.File]::Open($file, 'Open', 'Write')
                    $isLocked = $false
                }
                catch {
                    $isLocked = $true
                }
                finally {
                    if ($fileStream) { $fileStream.Close() }
                }
            } while ($isLocked -and $attempt -lt $maxAttempts)
            
        }
        catch {
            Write-Verbose &quot;File unlock check failed: $($_.Exception.Message)&quot;
        }
    }
}
</code></pre>
<h2 id="error-handling-and-logging">Error Handling and Logging</h2>
<h3 id="structured-error-reporting">Structured Error Reporting</h3>
<pre><code class="lang-powershell"># Standardized error reporting across all commands
function Write-NoorError {
    param([string]$Message, [string]$Component)
    
    Write-Host &quot;‚ùå NOOR-ERROR [$Component]: $Message&quot; -ForegroundColor Red
    Write-EventLog -LogName Application -Source &quot;NOOR Canvas&quot; -EventId 1001 -EntryType Error -Message &quot;$Component: $Message&quot; -ErrorAction SilentlyContinue
}

# Usage example
Write-NoorError -Message &quot;Build compilation failed&quot; -Component &quot;NC-BUILD&quot;
</code></pre>
<h3 id="verbose-output">Verbose Output</h3>
<pre><code class="lang-powershell"># Conditional verbose output based on -Verbose parameter
if ($PSBoundParameters['Verbose']) {
    Write-Host &quot;üîç NOOR-DEBUG: Checking workspace structure...&quot; -ForegroundColor Gray
    Write-Host &quot;   Workspace Root: $workspaceRoot&quot; -ForegroundColor Gray
    Write-Host &quot;   Project Path: $projectPath&quot; -ForegroundColor Gray
}
</code></pre>
<h2 id="integration-points">Integration Points</h2>
<h3 id="powershell-profile-integration">PowerShell Profile Integration</h3>
<p>Commands integrate with the PowerShell profile system for global availability:</p>
<pre><code class="lang-powershell"># Automatic loading in Microsoft.PowerShell_profile.ps1
if (Test-Path &quot;D:\PROJECTS\NOOR CANVAS\Workspaces\Global&quot;) {
    $env:PATH += &quot;;D:\PROJECTS\NOOR CANVAS\Workspaces\Global&quot;
}
</code></pre>
<h3 id="vs-code-task-integration">VS Code Task Integration</h3>
<p>Commands are integrated into VS Code tasks for IDE usage:</p>
<pre><code class="lang-json">{
    &quot;label&quot;: &quot;NOOR Canvas: Start Application&quot;,
    &quot;type&quot;: &quot;shell&quot;,
    &quot;command&quot;: &quot;nc&quot;,
    &quot;group&quot;: {
        &quot;kind&quot;: &quot;build&quot;,
        &quot;isDefault&quot;: true
    },
    &quot;presentation&quot;: {
        &quot;echo&quot;: true,
        &quot;reveal&quot;: &quot;always&quot;,
        &quot;focus&quot;: false,
        &quot;panel&quot;: &quot;shared&quot;
    }
}
</code></pre>
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="command-execution-speed">Command Execution Speed</h3>
<ul>
<li><strong>Script Caching</strong>: PowerShell scripts are compiled and cached for faster execution</li>
<li><strong>Path Resolution</strong>: Optimized path detection minimizes file system calls</li>
<li><strong>Process Management</strong>: Efficient process enumeration and termination</li>
<li><strong>Database Connections</strong>: Connection pooling for NCT command</li>
</ul>
<h3 id="memory-usage">Memory Usage</h3>
<ul>
<li><strong>Minimal Footprint</strong>: Commands designed to use minimal system resources</li>
<li><strong>Clean Termination</strong>: Proper cleanup of temporary objects and connections</li>
<li><strong>Garbage Collection</strong>: Explicit disposal of database connections and file streams</li>
</ul>
<h2 id="security-model">Security Model</h2>
<h3 id="execution-policy">Execution Policy</h3>
<pre><code class="lang-powershell"># Commands respect PowerShell execution policy
if ((Get-ExecutionPolicy) -eq 'Restricted') {
    Write-Warning &quot;PowerShell execution policy is Restricted. Commands may not execute.&quot;
    Write-Host &quot;Consider running: Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser&quot;
}
</code></pre>
<h3 id="database-security">Database Security</h3>
<ul>
<li><strong>Development Isolation</strong>: Commands only access development databases (KSESSIONS_DEV)</li>
<li><strong>Parameterized Queries</strong>: All SQL operations use parameterized queries</li>
<li><strong>Connection Timeout</strong>: 1-hour timeout prevents hung connections</li>
<li><strong>Credential Management</strong>: Database credentials stored in configuration files only</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<ol>
<li><p><strong>Command Not Found</strong></p>
<pre><code class="lang-powershell"># Reload PowerShell profile
. $PROFILE
</code></pre>
</li>
<li><p><strong>Permission Denied</strong></p>
<pre><code class="lang-powershell"># Check execution policy
Get-ExecutionPolicy
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
</code></pre>
</li>
<li><p><strong>Port Already in Use</strong></p>
<pre><code class="lang-powershell"># Kill existing processes
iiskill
# Wait and retry
Start-Sleep -Seconds 5
nc
</code></pre>
</li>
</ol>
<h3 id="diagnostic-commands">Diagnostic Commands</h3>
<pre><code class="lang-powershell"># Check command availability
Get-Command nc, nct, ncdoc, iiskill -ErrorAction SilentlyContinue

# Verify workspace structure
Test-Path &quot;D:\PROJECTS\NOOR CANVAS\Workspaces\Global\*.ps1&quot;

# Check running processes
Get-Process -Name &quot;*iisexpress*&quot;, &quot;*dotnet*&quot; -ErrorAction SilentlyContinue
</code></pre>
<p>For user-friendly guides on using these commands, see the <a href="../user-guides/global-commands-user-guide.html">Global Commands User Guide</a>.</p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/asifhussain60/NOOR-CANVAS/blob/master/DocFX/articles/technical/global-commands-technical-reference.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      NOOR CANVAS Islamic Content Sharing Platform
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
