@using Microsoft.AspNetCore.Components
@using NoorCanvas.ViewModels
@using NoorCanvas.Components.Shared
@using NoorCanvas.Components.Host

@* Sidebar component for HostControlPanel - Contains session management and controls *@
<div style="display:flex;justify-content:center;width:100%;">
    <div style="display:flex;flex-direction:column;gap:1.5rem;align-items:stretch;width:50%;background:linear-gradient(135deg,#FFFFFF,#F8F9FA);border-radius:2rem;padding:2rem;box-shadow:0 20px 40px -12px rgba(0,0,0,0.35),0 8px 16px -8px rgba(0,0,0,0.2);border:1px solid rgba(212,175,55,0.3);position:relative;overflow:hidden;">
        <!-- Decorative gradient overlay -->
        <div style="position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#D4AF37,#FFD700,#D4AF37);border-radius:2rem 2rem 0 0;"></div>
        
        <!-- SignalR Status Icon (Top-Right Modern Design) -->
        <div style="position:absolute;top:1rem;right:1rem;z-index:10;">
            <div style="width:2.5rem;height:2.5rem;border-radius:50%;background:@(OnGetSignalRStatusColor() == "#10B981" ? "linear-gradient(135deg,#10B981,#059669)" : "linear-gradient(135deg,#EF4444,#DC2626)");box-shadow:0 4px 12px rgba(0,0,0,0.15);display:flex;align-items:center;justify-content:center;border:2px solid white;">
                <i class="@OnGetSignalRStatusIcon()" style="font-size:1rem;color:white;"></i>
            </div>
        </div>
        
        <!-- Session Details Panel -->
        <div style="background-color:white;padding:1.5rem;border-radius:1.5rem;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);border:1px solid #D4AF37;text-align:center;">
            <h2 style="font-weight:800;font-size:2.25rem;color:#D4AF37;margin-bottom:1rem;text-shadow:0 2px 4px rgba(212,175,55,0.2);letter-spacing:-0.025em;">@(Model?.SessionName ?? "Loading Session...")</h2>
            <p style="color:#6B7280;font-size:1rem;line-height:1.625;margin-bottom:1rem;font-weight:500;">@(OnFormatSessionDescriptionToProperCase(Model?.SessionDescription ?? "Session details are being loaded..."))</p>
        </div>

        <!-- Session Controls Panel -->
        <div style="width:100%;background-color:#F8F5F1;border-radius:1.5rem;box-shadow:inset 0 2px 4px 0 rgba(0,0,0,0.06);border:1px solid #D4AF37;padding:1.5rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;">
            <h3 style="display:flex;align-items:center;justify-content:center;gap:0.5rem;font-weight:800;font-size:1.5rem;color:#006400;margin-bottom:0.5rem;text-align:center;">
                @* FontAwesome icon with Unicode fallback to prevent garbled text *@
                <i class="fa-solid fa-sliders" style="color:#006400;" aria-hidden="true">⚙</i>
                <span>SESSION CONTROLS</span>
            </h3>

            <!-- Session Time & Duration Cards -->
            <div style="width:100%;display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
                <!-- Session Time Card -->
                <div style="background-color:white;border-radius:0.75rem;padding:1rem;text-align:center;border:1px solid #D4AF37;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);">
                    <i class="fa-solid fa-clock" style="font-size:1.5rem;color:#006400;margin-bottom:0.5rem;"></i>
                    <p style="font-family:'Inter',sans-serif;font-size:0.75rem;text-transform:uppercase;font-weight:500;color:#4B3C2B;margin:0 0 0.25rem 0;">Session Time</p>
                    <p style="font-family:'Poppins',sans-serif;font-size:1rem;font-weight:700;color:#4B3C2B;margin:0;">@(Model?.ScheduledTime ?? "TBD")</p>
                </div>
                
                <!-- Session Duration Card -->
                <div style="background-color:white;border-radius:0.75rem;padding:1rem;text-align:center;border:1px solid #D4AF37;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);">
                    <i class="fa-solid fa-hourglass-half" style="font-size:1.5rem;color:#006400;margin-bottom:0.5rem;"></i>
                    <p style="font-family:'Inter',sans-serif;font-size:0.75rem;text-transform:uppercase;font-weight:500;color:#4B3C2B;margin:0 0 0.25rem 0;">Duration</p>
                    <p style="font-family:'Poppins',sans-serif;font-size:1rem;font-weight:700;color:#4B3C2B;margin:0;">@OnFormatDurationFromString(Model?.ScheduledDuration)</p>
                </div>
            </div>

            <!-- User Registration Link Display -->
            @if (!string.IsNullOrEmpty(UserToken))
            {
                <UserRegistrationLink UserToken="@UserToken" BaseUrl="https://localhost:9091" />
            }
            
            <div style="width:100%;display:flex;justify-content:center;gap:1rem;flex-direction:column;">
                <button @onclick="OnStartSession" 
                        disabled="@(IsLoading || Model?.SessionStatus == "Active")"
                        style="width:100%;padding:1rem 2rem;border-radius:1.5rem;box-shadow:0 10px 15px -3px rgba(0,100,0,0.4);color:white;font-weight:700;font-size:1.125rem;background-color:#006400;border:none;transition:transform 0.2s ease;display:flex;align-items:center;justify-content:center;gap:0.75rem;@(IsLoading || Model?.SessionStatus == "Active" ? "cursor:not-allowed;opacity:0.6;" : "cursor:pointer;opacity:1;")" 
                        onmouseover="this.style.backgroundColor='#059669'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.backgroundColor='#006400'; this.style.transform='scale(1)'">
                    @* FontAwesome icon with Unicode fallback to prevent garbled text *@
                    <i class="fa-solid fa-play" style="font-size:1.25rem;" aria-hidden="true">▶</i>
                    <span>Start Session</span>
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public HostControlPanelViewModel? Model { get; set; }
    [Parameter] public string? UserToken { get; set; }
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public EventCallback OnStartSession { get; set; }
    [Parameter] public Func<string> OnGetSignalRStatusColor { get; set; } = () => "#EF4444";
    [Parameter] public Func<string> OnGetSignalRStatusIcon { get; set; } = () => "fa-solid fa-wifi";
    [Parameter] public Func<string?, string> OnFormatSessionDescriptionToProperCase { get; set; } = (desc) => desc ?? "";
    [Parameter] public Func<string?, string> OnFormatDurationFromString { get; set; } = (duration) => duration ?? "";
}