<div data-ng-controller="adminAhadeesCtl" class="admin-ahadees-container">

    <div class="container" data-ng-show="vm.viewReady">

        <div data-zu-blank-row data-repeat="1"></div>

        <div class="row">
            <div class="col-md-offset-1 col-md-8">
                <div class="md-card">
                    <div class="md-card-header">
                        <h4><i class="fa fa-comments"></i> Ahadees Management - Enhanced Islamic Narrations System</h4>
                    </div>
                    <div class="md-card-content">
                        
                        <!-- Search Section -->
                        <div class="row" data-ng-if="vm.mode !== 'add' && vm.mode !== 'edit'">
                            <div class="col-md-12">
                                <div class="search-section-material">
                                    <div class="search-section-title">
                                        <i class="fa fa-search"></i> Search Ahadees Collection
                                    </div>
                                    <form>
                                        <div class="md-form-group">
                                            <label class="md-form-label">Search All Fields</label>
                                            <input type="text" class="md-form-control" 
                                                   data-ng-model="vm.ahadeesSearch.searchText"
                                                   placeholder="Search across narrator, subject, English text, Arabic text, and transliteration">
                                            <small class="form-helper-text">Search will automatically trigger when you stop typing (minimum 2 characters)</small>
                                        </div>
                                        <div class="form-actions-material">
                                            <button type="button" class="md-btn md-btn-success" 
                                                    data-ng-click="vm.mode = 'add'">
                                                <i class="fa fa-plus"></i> Add New Hadees
                                            </button>
                                            <button type="button" class="md-btn md-btn-info" 
                                                    data-ng-click="vm.loadLastTenAhadees()">
                                                <i class="fa fa-list"></i> Load Recent
                                            </button>
                                            <button type="button" class="md-btn md-btn-warning" 
                                                    data-ng-click="vm.resetView()">
                                                <i class="fa fa-refresh"></i> Reset
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Add/Edit Form -->
                        <div class="row" data-ng-if="vm.mode === 'add' || vm.mode === 'edit'">
                            <div class="col-md-12">
                                <div class="form-section-material">
                                    <div class="form-section-title" data-ng-if="vm.mode === 'add'">
                                        <i class="fa fa-plus"></i> Add New Hadees
                                    </div>
                                    <div class="form-section-title" data-ng-if="vm.mode === 'edit'">
                                        <i class="fa fa-edit"></i> Edit Hadees
                                    </div>
                                    <form>
                                        <div class="md-form-group narrator-input-container">
                                            <label class="md-form-label required">Source/Narrator *</label>
                                            <div class="custom-autocomplete">
                                                <input type="text" class="md-form-control narrator-input" 
                                                       data-ng-model="vm.fAhadees.narrator"
                                                       data-ng-keyup="vm.onNarratorKeyup($event)"
                                                       data-ng-keydown="vm.onNarratorKeydown($event)"
                                                       data-ng-focus="vm.showNarratorSuggestions = true"
                                                       data-ng-blur="vm.hideNarratorSuggestions()"
                                                       placeholder="Type to search: Sahih Bukhari, Sahih Muslim, Sunan Abu Dawud..."
                                                       autocomplete="off"
                                                       required>
                                                <!-- Custom dropdown for suggestions -->
                                                <div class="custom-autocomplete-dropdown" 
                                                     data-ng-show="vm.showNarratorSuggestions && vm.filteredNarratorSuggestions.length > 0">
                                                    <div class="suggestion-item"
                                                         data-ng-repeat="suggestion in vm.filteredNarratorSuggestions track by $index"
                                                         data-ng-class="{'suggestion-highlighted': $index === vm.selectedSuggestionIndex}"
                                                         data-ng-mousedown="vm.selectNarratorSuggestion(suggestion)"
                                                         data-ng-mouseover="vm.selectedSuggestionIndex = $index">
                                                        <i class="fa fa-user"></i> {{suggestion}}
                                                    </div>
                                                    <div class="suggestion-footer" data-ng-if="vm.filteredNarratorSuggestions.length > 0">
                                                        <small class="text-muted">
                                                            <i class="fa fa-keyboard-o"></i> Use ↑↓ to navigate, Enter to select, Esc to close
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                            <small class="form-helper-text">
                                                <i class="fa fa-lightbulb-o"></i> Start typing to see suggestions from existing narrators
                                                <span data-ng-if="vm.narratorSuggestions.length > 0" class="text-muted">
                                                    ({{vm.narratorSuggestions.length}} available)
                                                </span>
                                            </small>
                                        </div>
                                        <div class="md-form-group">
                                            <label class="md-form-label">Subject/Topic</label>
                                            <input type="text" class="md-form-control" 
                                                   data-ng-model="vm.fAhadees.subject"
                                                   placeholder="e.g., Prayer, Fasting, Charity, Manners">
                                            <small class="form-helper-text">Text will be automatically formatted in proper case</small>
                                        </div>
                                        <div class="md-form-group">
                                            <label class="md-form-label required">Arabic Text *</label>
                                            <textarea class="md-form-control rich-arabic-material arabic-centered" rows="6" 
                                                      data-ng-model="vm.fAhadees.ahadeesArabic"
                                                      placeholder="قَالَ رَسُولُ اللَّهِ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ..."
                                                      required></textarea>
                                            <small class="form-helper-text">Rich Arabic text input with beautiful Arabic font styling</small>
                                        </div>
                                        <div class="md-form-group">
                                            <label class="md-form-label required">English Translation *</label>
                                            <textarea class="md-form-control" rows="4" 
                                                      data-ng-model="vm.fAhadees.ahadeesEnglish"
                                                      placeholder="Enter English translation of the Hadees"
                                                      required></textarea>
                                        </div>
                                        <div class="md-form-group">
                                            <label class="md-form-label">Reference</label>
                                            <input type="text" class="md-form-control" 
                                                   data-ng-model="vm.fAhadees.reference"
                                                   placeholder="e.g., Book 2, Hadees 123">
                                        </div>
                                        <div class="form-actions-material">
                                            <button type="button" class="md-btn md-btn-primary md-btn-raised" 
                                                    data-ng-click="vm.saveAhadees()"
                                                    data-ng-disabled="!vm.fAhadees.narrator || !vm.fAhadees.ahadeesArabic || !vm.fAhadees.ahadeesEnglish">
                                                <i class="fa fa-save"></i> Save Hadees
                                            </button>
                                            <button type="button" class="md-btn md-btn-secondary" 
                                                    data-ng-click="vm.cancelAhadees()"
                                                    style="background-color: #ff9800; color: white; border: 1px solid #ff9800;">
                                                <i class="fa fa-times" aria-hidden="true"></i> Cancel
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Results Section -->
                        <div class="row" data-ng-if="vm.result.length > 0 && (vm.mode !== 'add' && vm.mode !== 'edit')">
                            <div class="col-md-12">
                                <div class="results-section-material">
                                    <div class="results-header">
                                        <h5><i class="fa fa-list"></i> Search Results ({{vm.result.length}})</h5>
                                    </div>
                                    <div data-ng-repeat="hadees in vm.result track by hadees.ahadeesId" class="hadees-result-card">
                                        <div class="hadees-card-header">
                                            <h6>
                                                <strong data-ng-if="hadees.narrator">{{hadees.narrator}}</strong>
                                                <strong data-ng-if="!hadees.narrator" class="text-muted">[Narrator Unknown]</strong>
                                                <span data-ng-if="hadees.subject" class="hadees-subject">- {{hadees.subject}}</span>
                                                <span data-ng-if="hadees.reference" class="hadees-reference">({{hadees.reference}})</span>
                                            </h6>
                                        </div>
                                        <div class="hadees-card-content">
                                            <div class="hadees-arabic-display">
                                                {{hadees.ahadeesArabic}}
                                            </div>
                                            <div class="hadees-english-display">
                                                {{hadees.ahadeesEnglish}}
                                            </div>
                                        </div>
                                        <div class="hadees-card-actions">
                                            <button class="md-btn md-btn-primary md-btn-small" 
                                                    data-ng-click="vm.editAhadees(hadees)">
                                                <i class="fa fa-edit"></i> Edit
                                            </button>
                                            <button class="md-btn md-btn-danger md-btn-small" 
                                                    data-ng-click="vm.deleteAhadees(hadees)"
                                                    data-ng-confirm-click="Are you sure you want to delete this Hadees? This action cannot be undone.">
                                                <i class="fa fa-trash"></i> Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- No Results Message -->
                        <div class="row" data-ng-if="vm.result.length === 0 && vm.searchPerformed">
                            <div class="col-md-12">
                                <div class="md-alert md-alert-info">
                                    <i class="fa fa-info-circle"></i> No Ahadees found matching your search criteria.
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <div data-zu-blank-row data-repeat="1"></div>

</div>

<!-- Custom Autocomplete Styles -->
<style>
.narrator-input-container {
    position: relative;
}

.custom-autocomplete {
    position: relative;
}

.custom-autocomplete-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 4px 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
}

.suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.2s ease;
}

.suggestion-item:hover,
.suggestion-highlighted {
    background-color: #f8f9fa !important;
    color: #333;
}

.suggestion-item:last-child {
    border-bottom: none;
}

.suggestion-item i {
    margin-right: 8px;
    color: #6c757d;
}

.suggestion-footer {
    padding: 8px 15px;
    background-color: #f8f9fa;
    border-top: 1px solid #e9ecef;
    text-align: center;
}

.suggestion-footer small {
    font-size: 11px;
}

.narrator-input:focus + .custom-autocomplete-dropdown {
    border-color: #007bff;
}
</style>
