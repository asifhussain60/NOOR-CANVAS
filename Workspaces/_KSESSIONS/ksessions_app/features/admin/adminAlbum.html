

<div class="matter" data-ng-controller="adminAlbumCtl">
    <!-- Custom styles for enhanced upload button -->
    <style>
        .file-upload-btn {
            font-weight: 500;
            font-size: 14px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            text-align: center;
            display: block;
        }
        
        .file-upload-btn:hover:not(.disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .file-upload-btn.btn-primary {
            background-color: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        .file-upload-btn.btn-success {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .file-upload-btn.btn-warning {
            background-color: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }
        
        .file-upload-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .image-preview-container {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .upload-info {
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        
        .upload-info:hover {
            opacity: 1;
        }
    </style>
    
    <div class="container">
        <div class="row">

            <div class=" col-md-8 col-md-offset-1">

                <div class="admin-widget wred">

                    <div class="admin-widget-head">
                        <i class="fa fa-file-image-o"></i>
                        <span class="padding-left10">Manage Albums</span>
                    </div>
                    <div class="admin-widget-content">

                        <div class="padd">

                            <form class="form-horizontal">

                                <!-- Current Albums dropdown list -->
                                <div class="form-group">
                                    <label class="control-label col-md-3">Current Albums</label>
                                    <div class="col-md-7">
                                        <select ng-model="vm.fAlbum.albumId"
                                                tabindex=""
                                                class="form-control"
                                                data-ng-disabled="vm.isNewAlbum"
                                                ng-options="album.id as album.name for album in vm.cm.albums | orderObjectBy:'name' ">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn" data-ng-click="vm.addNewAlbum(true)">
                                            <i class=" fa fa-plus" aria-hidden="true">
                                            </i>
                                        </button>
                                        <button class="btn btn-danger"
                                                data-ng-disabled="!vm.fAlbum.albumId"
                                                data-ng-click="vm.deleteAlbum(vm.fAlbum.albumId)">
                                            <i class="fa fa-trash" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Album Title -->
                                <div class="form-group">
                                    <label class="control-label col-md-3" for="albumTitle">
                                        Album Title
                                    </label>
                                    <div class="col-md-7">
                                        <input type="text" id="albumTitle"
                                               data-ng-model="vm.fAlbum.name"
                                               data-ng-disabled="!vm.isNewAlbum && !vm.fAlbum.albumId"
                                               tabindex=""
                                               class="form-control">
                                    </div>
                                </div>

                                <!-- Default Speaker -->
                                <div class="form-group">
                                    <label class="control-label col-md-3">Default Speaker</label>
                                    <div class="col-md-7">
                                        <select ng-model="vm.fAlbum.speakerId"
                                                tabindex=""
                                                class="form-control"
                                                data-ng-disabled="!vm.isNewAlbum && !vm.fAlbum.albumId"
                                                ng-options="speaker.speakerId as speaker.speakerName for speaker in vm.cm.speakers | orderObjectBy:'speakerName' ">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Album Image -->
                                <div class="form-group">
                                    <label class="control-label col-md-3">
                                        Album Image
                                    </label>
                                    <div class="col-md-2">
                                        <div class="image-upload-container" style="position: relative;">
                                            <label class="btn file-upload-btn"
                                                   data-ng-class="{
                                                       'btn-success': vm.imageFile && !vm.uploadingImage, 
                                                       'btn-primary': !vm.imageFile && !vm.uploadingImage,
                                                       'btn-warning': vm.uploadingImage,
                                                       'disabled': (!vm.isNewAlbum && !vm.fAlbum.albumId) || vm.uploadingImage
                                                   }"
                                                   style="width: 100%; margin-bottom: 8px; position: relative; overflow: hidden; cursor: pointer; border: 2px solid; border-radius: 6px; transition: all 0.3s ease;">
                                                <input type="file" id="imageUpload"
                                                       accept="image/jpeg,image/jpg,image/png,image/gif"
                                                       data-file-model="vm.imageFile"
                                                       style="position: absolute; left: -9999px; opacity: 0;"
                                                       data-ng-disabled="!vm.isNewAlbum && !vm.fAlbum.albumId" />
                                                
                                                <!-- Loading spinner -->
                                                <span data-ng-if="vm.uploadingImage" style="display: inline-block;">
                                                    <i class="fa fa-spinner fa-spin" style="margin-right: 8px;"></i>
                                                    Loading...
                                                </span>
                                                
                                                <!-- Success state -->
                                                <span data-ng-if="vm.imageFile && !vm.uploadingImage" style="display: inline-block;">
                                                    <i class="fa fa-check" style="margin-right: 8px; color: #fff;"></i>
                                                    File Selected
                                                </span>
                                                
                                                <!-- Default state -->
                                                <span data-ng-if="!vm.imageFile && !vm.uploadingImage" style="display: inline-block;">
                                                    <i class="fa fa-upload" style="margin-right: 8px;"></i>
                                                    Upload Image
                                                </span>
                                            </label>
                                            
                                            <!-- Clear button when file is selected -->
                                            <button type="button" class="btn btn-sm btn-danger" 
                                                    data-ng-if="vm.imageFile && !vm.uploadingImage"
                                                    data-ng-click="vm.clearImage()"
                                                    style="width: 100%; font-size: 11px; padding: 4px 8px;">
                                                <i class="fa fa-times"></i> Clear Image
                                            </button>
                                        </div>
                                        
                                        <div class="upload-info" style="text-align: center; margin-top: 8px;">
                                            <small style="color: #666; font-size: 11px; line-height: 1.3;">
                                                <i class="fa fa-info-circle"></i> JPG, PNG, GIF<br />
                                                Max 2MB recommended
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-6" col-md-offset-3>
                                        <div class="image-preview-container" style="position: relative;">
                                            <!-- Loading state for image preview -->
                                            <div class="image-loading" 
                                                 data-ng-if="vm.uploadingImage"
                                                 style="border: 2px dashed #fbbf24; padding: 30px; text-align: center; background-color: #fef3c7; border-radius: 8px; color: #92400e;">
                                                <div style="margin-bottom: 15px;">
                                                    <i class="fa fa-spinner fa-spin" style="font-size: 24px; color: #f59e0b;"></i>
                                                </div>
                                                <div style="font-size: 14px; font-weight: 500;">Processing image...</div>
                                                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Please wait while we prepare your image</div>
                                            </div>
                                            
                                            <!-- Show placeholder when no image -->
                                            <div class="album-image-placeholder"
                                                 data-ng-if="!vm.getImageUrl() && !vm.uploadingImage"
                                                 style="border: 2px dashed #cbd5e1; padding: 30px; text-align: center; background-color: #f8fafc; border-radius: 8px; color: #64748b; transition: all 0.3s ease;">
                                                <div style="margin-bottom: 15px;">
                                                    <i class="fa fa-image" style="font-size: 32px; color: #cbd5e1;"></i>
                                                </div>
                                                <div style="font-size: 14px; font-weight: 500;">100px × 100px</div>
                                                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Select an image to preview</div>
                                            </div>
                                            
                                            <!-- Show image preview when available -->
                                            <div class="album-image" data-ng-if="vm.getImageUrl() && !vm.uploadingImage"
                                                 style="text-align: center; border: 2px solid #e2e8f0; padding: 15px; border-radius: 8px; background-color: #ffffff; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); transition: all 0.3s ease;">
                                                <div style="margin-bottom: 10px;">
                                                    <img id="imgPreview"
                                                         data-ng-src="{{vm.getImageUrl()}}"
                                                         style="max-width: 100px; max-height: 100px; border: 1px solid #e2e8f0; border-radius: 4px; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);" 
                                                         alt="Album Image Preview"
                                                         onerror="console.log('Image failed to load:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';" />
                                                    <!-- Fallback for missing image -->
                                                    <div style="display: none; padding: 20px; border: 2px dashed #e2e8f0; border-radius: 4px; color: #94a3b8;">
                                                        <i class="fa fa-image" style="font-size: 24px; margin-bottom: 8px;"></i>
                                                        <div style="font-size: 12px;">Image file not found</div>
                                                        <div style="font-size: 10px; margin-top: 4px;">Path: {{vm.getImageUrl()}}</div>
                                                    </div>
                                                </div>
                                                
                                                <div style="font-size: 12px; color: #64748b; margin-bottom: 8px;" data-ng-if="vm.imageFile">
                                                    <i class="fa fa-file-image-o"></i> 
                                                    <strong>{{vm.imageFile.name}}</strong><br />
                                                    <span style="color: #94a3b8;">{{(vm.imageFile.size/1024).toFixed(1)}} KB</span>
                                                </div>
                                                
                                                <!-- Show image path for debugging -->
                                                <div style="font-size: 10px; color: #94a3b8; margin-bottom: 8px;" data-ng-if="!vm.imageFile && vm.fAlbum.imagePath">
                                                    <i class="fa fa-database"></i> 
                                                    Database Image: <strong>{{vm.fAlbum.imagePath}}</strong>
                                                </div>
                                                
                                                <div style="margin-top: 10px;">
                                                    <span class="badge" style="background-color: #10b981; color: white; font-size: 10px; padding: 3px 8px;" data-ng-if="vm.imageFile">
                                                        <i class="fa fa-check"></i> Ready to upload
                                                    </span>
                                                    <span class="badge" style="background-color: #3b82f6; color: white; font-size: 10px; padding: 3px 8px;" data-ng-if="!vm.imageFile && vm.fAlbum.imagePath">
                                                        <i class="fa fa-database"></i> From database
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Album Description -->
                                <div class="form-group">
                                    <label class="control-label col-md-3" for="albumDesc">
                                        Description
                                    </label>
                                    <div class="col-md-9">
                                        <textarea id="albumDesc" name="content"
                                                  class="form-control"
                                                  data-ng-model="vm.fAlbum.description"
                                                  data-froala="vm.froalaOptions"></textarea>
                                    </div>
                                </div>

                                <!-- Album Creation Date -->
                                <div class="form-group">
                                    <label class="control-label col-md-3" for="albumCreatedDate">
                                        Group Start Date
                                    </label>
                                    <div class="col-md-9">
                                        <input type="date" id="albumCreatedDate"
                                               data-ng-model="vm.fAlbum.createdDate"
                                               data-ng-disabled="!vm.isNewAlbum && !vm.fAlbum.albumId"
                                               tabindex=""
                                               class="form-control">
                                    </div>
                                </div>


                                <!-- Add Members to Group -->
                                <div class="form-group">
                                    <label class="control-label col-md-3">
                                        Select Members
                                    </label>
                                    <div class="col-md-9">

                                        <div data-zu-checklist-group="{cols:3}"
                                             data-disable-expression="!vm.isNewAlbum && !vm.fAlbum.albumId"
                                             data-family-members="vm.cm.families"
                                             data-show-expiry-days="true"
                                             data-show-passive-link="true"
                                             data-current-album="vm.cm.currentAlbum">
                                        </div>
                                    </div>
                                </div>

                                <!-- Submit Buttons -->
                                <div class="form-group">
                                    <div class="col-md-12 text-right">
                                        <button class="btn btn-purple"
                                                type="button"
                                                tabindex="20"
                                                data-ng-click="vm.submit()"
                                                data-ng-disabled="vm.uploadingImage">
                                            <span data-ng-if="!vm.uploadingImage">Submit</span>
                                            <span data-ng-if="vm.uploadingImage"><i class="fa fa-spinner fa-spin"></i> Processing...</span>
                                        </button>
                                        <button class="btn btn-default"
                                                type="button"
                                                tabindex="22"
                                                data-ng-if="vm.isNewAlbum || vm.fAlbum.albumId"
                                                data-ng-click="vm.addNewAlbum(false)">
                                            Cancel
                                        </button>
                                    </div>
                                </div>

                            </form>

                        </div>
                    </div>

                </div>


            </div>


        </div>
    </div>
</div>