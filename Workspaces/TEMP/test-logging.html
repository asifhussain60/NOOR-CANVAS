<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NOOR Canvas Logging Test</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 2rem; background: #f5f5f5; }
        .container { max-width: 800px; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-left: 4px solid #007bff; }
        .test-button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 0.5rem; }
        .test-button:hover { background: #0056b3; }
        .status { padding: 0.5rem; margin: 0.5rem 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç NOOR Canvas Logging System Test</h1>
        <p><strong>Instructions:</strong> Open browser developer tools (F12) to see console logs, then test the logging functionality.</p>
        
        <div class="test-section">
            <h3>Client-Side Logging Tests</h3>
            <button class="test-button" onclick="testDebugLog()">Test DEBUG Log</button>
            <button class="test-button" onclick="testInfoLog()">Test INFO Log</button>
            <button class="test-button" onclick="testWarnLog()">Test WARN Log</button>
            <button class="test-button" onclick="testErrorLog()">Test ERROR Log</button>
            <button class="test-button" onclick="testFatalLog()">Test FATAL Log</button>
            <div id="clientLogResults"></div>
        </div>
        
        <div class="test-section">
            <h3>Server-Side Transmission Tests</h3>
            <button class="test-button" onclick="testServerTransmission()">Test Server Log Transmission</button>
            <button class="test-button" onclick="testErrorHandling()">Test Error Boundary</button>
            <div id="serverLogResults"></div>
        </div>
        
        <div class="test-section">
            <h3>Session Context Tests</h3>
            <button class="test-button" onclick="testSessionContext()">Set Test Session Context</button>
            <button class="test-button" onclick="testContextualLog()">Test Contextual Logging</button>
            <div id="contextResults"></div>
        </div>
    </div>

    <!-- Copy the NOOR logging utility inline for testing -->
    <script>
        window.NoorLogger = (function() {
            'use strict';
            
            const LOG_LEVELS = { DEBUG: 0, INFO: 1, WARN: 2, ERROR: 3, FATAL: 4 };
            const LOG_LEVEL_NAMES = ['DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL'];
            const LOG_LEVEL_COLORS = ['#6c757d', '#0d6efd', '#fd7e14', '#dc3545', '#6f42c1'];
            
            let currentLogLevel = LOG_LEVELS.DEBUG; // Set to DEBUG for testing
            let sessionId = 'test-session-123';
            let userId = 'test-user-456';
            
            function log(level, component, message, data = null) {
                if (level < currentLogLevel) return;
                
                const timestamp = new Date().toISOString().substr(11, 12);
                const levelName = LOG_LEVEL_NAMES[level];
                const prefix = `[${timestamp} ${levelName}] ${component}:`;
                const color = LOG_LEVEL_COLORS[level];
                
                if (data) {
                    console.log(`%c${prefix}%c ${message}`, `color: ${color}; font-weight: bold;`, 'color: inherit;', data);
                } else {
                    console.log(`%c${prefix}%c ${message}`, `color: ${color}; font-weight: bold;`, 'color: inherit;');
                }
                
                // Send to server if WARN or higher
                if (level >= LOG_LEVELS.WARN && window.fetch) {
                    sendToServer(level, component, message, data);
                }
            }
            
            function sendToServer(level, component, message, data) {
                const payload = {
                    timestamp: new Date().toISOString(),
                    level: LOG_LEVEL_NAMES[level],
                    component: component,
                    message: message,
                    data: data,
                    sessionId: sessionId,
                    userId: userId,
                    url: window.location.href,
                    userAgent: navigator.userAgent
                };
                
                return fetch('http://localhost:9090/api/logs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            }
            
            return {
                setSession: function(sId, uId) { sessionId = sId; userId = uId; },
                debug: function(component, message, data) { log(LOG_LEVELS.DEBUG, component, message, data); },
                info: function(component, message, data) { log(LOG_LEVELS.INFO, component, message, data); },
                warn: function(component, message, data) { log(LOG_LEVELS.WARN, component, message, data); },
                error: function(component, message, data) { log(LOG_LEVELS.ERROR, component, message, data); },
                fatal: function(component, message, data) { log(LOG_LEVELS.FATAL, component, message, data); },
                sendToServer: sendToServer
            };
        })();
    </script>
    
    <script>
        // Test Functions
        function testDebugLog() {
            NoorLogger.debug('TEST-CLIENT', 'Debug level logging test', { timestamp: new Date(), testType: 'debug' });
            updateResults('clientLogResults', 'DEBUG log sent to browser console', 'info');
        }
        
        function testInfoLog() {
            NoorLogger.info('TEST-CLIENT', 'Info level logging test', { timestamp: new Date(), testType: 'info' });
            updateResults('clientLogResults', 'INFO log sent to browser console', 'info');
        }
        
        function testWarnLog() {
            NoorLogger.warn('TEST-CLIENT', 'Warning level logging test', { timestamp: new Date(), testType: 'warn' });
            updateResults('clientLogResults', 'WARN log sent to browser console AND server', 'success');
        }
        
        function testErrorLog() {
            NoorLogger.error('TEST-CLIENT', 'Error level logging test', { timestamp: new Date(), testType: 'error' });
            updateResults('clientLogResults', 'ERROR log sent to browser console AND server', 'success');
        }
        
        function testFatalLog() {
            NoorLogger.fatal('TEST-CLIENT', 'Fatal level logging test', { timestamp: new Date(), testType: 'fatal' });
            updateResults('clientLogResults', 'FATAL log sent to browser console AND server', 'success');
        }
        
        function testServerTransmission() {
            NoorLogger.sendToServer(2, 'TEST-SERVER', 'Manual server transmission test', { manualTest: true })
                .then(() => updateResults('serverLogResults', 'Server transmission successful', 'success'))
                .catch(err => updateResults('serverLogResults', 'Server transmission failed: ' + err.message, 'error'));
        }
        
        function testErrorHandling() {
            try {
                // Intentionally throw an error to test error boundary
                throw new Error('Test error for boundary handling');
            } catch (e) {
                NoorLogger.error('ERROR-BOUNDARY', 'Caught and logged test error', { error: e.message, stack: e.stack });
                updateResults('serverLogResults', 'Error boundary test completed', 'success');
            }
        }
        
        function testSessionContext() {
            NoorLogger.setSession('test-session-789', 'test-user-101');
            updateResults('contextResults', 'Session context updated: Session=test-session-789, User=test-user-101', 'success');
        }
        
        function testContextualLog() {
            NoorLogger.warn('CONTEXT-TEST', 'Testing contextual logging with session/user data', { 
                feature: 'contextual-logging',
                timestamp: new Date()
            });
            updateResults('contextResults', 'Contextual log sent with session/user information', 'success');
        }
        
        function updateResults(elementId, message, type) {
            const resultsDiv = document.getElementById(elementId);
            const resultItem = document.createElement('div');
            resultItem.className = `status ${type}`;
            resultItem.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            resultsDiv.appendChild(resultItem);
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            NoorLogger.info('TEST-PAGE', 'Logging test page initialized');
            updateResults('clientLogResults', 'Logging system initialized', 'info');
        });
    </script>
</body>
</html>
