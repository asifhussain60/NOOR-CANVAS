<div class="etymology-wrapper"></div>
    <!-- 🟢 TEMPLATE LOADING CONFIRMATION -->
    <div style="background: #d4edda; border: 2px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
        <h4 style="color: #155724; margin: 0;">✅ Etymology Template Loaded Successfully</h4>
        <p style="margin: 5px 0 0 0; color: #155724;">
            Mode: <strong>{{etym.viewMode || 'initializing...'}}</strong> | 
            Enhanced: <strong>{{etym.isEnhancedMode || false}}</strong> | 
            Roots: <strong>{{etym.statistics.totalRoots || 0}}</strong>
        </p>
    </div>

    <div class="etymology-manager-container">
        
        <!-- DASHBOARD TILES - MOVED TO TOP -->
        <div class="row" style="margin-bottom: 30px;">
            <div class="col-md-12">
                <div class="card" style="border: 1px solid #e3e6f0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <div class="card-header" style="background: linear-gradient(135deg, #6a994e 0%, #588157 100%); color: white; border-radius: 12px 12px 0 0; padding: 20px;">
                        <h5 class="mb-0" style="font-weight: 500;">
                            <i class="fa fa-dashboard"></i> Etymology System Overview
                        </h5>
                    </div>
                    <div class="card-body" style="padding: 25px; background: linear-gradient(135deg, #f7f9fc 0%, #fefefe 100%);">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="dashboard-tile" style="padding: 20px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #3498db;">
                                    <h4 class="text-primary mb-1" style="font-weight: 600;">{{etym.statistics.totalRoots || 0}}</h4>
                                    <small class="text-muted" style="font-weight: 500;">Total Roots</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-tile" style="padding: 20px; background: #eaf4f4; border-radius: 8px; border-left: 4px solid #16a085;">
                                    <h4 class="text-success mb-1" style="font-weight: 600;">{{etym.statistics.totalDerivatives || 0}}</h4>
                                    <small class="text-muted" style="font-weight: 500;">Total Derivatives</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-tile" style="padding: 20px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #6a994e;">
                                    <h4 class="text-info mb-1" style="font-weight: 600;">{{etym.statistics.activeRoots || 0}}</h4>
                                    <small class="text-muted" style="font-weight: 500;">Active Roots</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-tile" style="padding: 20px; background: #f9f3e8; border-radius: 8px; border-left: 4px solid #e67e22;">
                                    <h4 class="text-warning mb-1" style="font-weight: 600;">{{etym.statistics.rootsModifiedToday || 0}}</h4>
                                    <small class="text-muted" style="font-weight: 500;">Modified Today</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SEARCH SECTION -->
        <div class="row" style="margin-bottom: 30px;">
            <div class="col-md-12">
                <!-- Search Bar -->
                <div class="card" style="border: 2px solid #6a994e; border-radius: 12px; box-shadow: 0 4px 12px rgba(106, 153, 78, 0.15);">
                    <div class="card-body" style="padding: 25px; background: linear-gradient(135deg, #f8fffe 0%, #f1f8f1 100%);">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="form-group mb-0">
                                    <input type="text" 
                                           id="searchTerm"
                                           class="form-control form-control-lg" 
                                           ng-model="etym.searchTerm"
                                           ng-change="etym.searchEtymologyUnified()"
                                           ng-keypress="etym.onSearchKeypress($event)"
                                           placeholder="🔍 Search by Arabic root, transliteration, or English meaning... (or leave empty to add new root)"
                                           style="font-size: 18px; padding: 18px; border: 2px solid #a7c957; border-radius: 10px;">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="btn-group w-100" role="group">
                                    <button type="button" 
                                            class="btn btn-lg"
                                            ng-click="etym.searchEtymologyUnified()"
                                            style="background: linear-gradient(135deg, #6a994e 0%, #588157 100%); color: white; border: none; border-radius: 10px 0 0 10px; font-weight: 500;">
                                        <i class="fa fa-search"></i> Search
                                    </button>
                                    <button type="button" 
                                            class="btn btn-lg"
                                            ng-click="etym.createNewEtymologyUnified(true)"
                                            style="background: linear-gradient(135deg, #a7c957 0%, #6a994e 100%); color: white; border: none; border-radius: 0 10px 10px 0; font-weight: 500;">
                                        <i class="fa fa-plus"></i> New Root
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search Results Quick Preview -->
                        <div ng-if="etym.searchResults && etym.searchResults.length > 1" 
                             class="mt-3 pt-3" 
                             style="border-top: 1px solid #d4e2d4;">
                            <small class="text-muted">
                                <i class="fa fa-info-circle"></i> 
                                Found {{etym.searchResults.length}} results. Currently showing: 
                                <strong>{{etym.currentEtymology.rootTransliteration || 'first result'}}</strong>
                            </small>
                            <div class="btn-group btn-group-sm ml-2" ng-if="etym.searchResults.length > 1">
                                <button type="button" 
                                        class="btn btn-outline-secondary btn-sm" 
                                        ng-repeat="result in etym.searchResults | limitTo:5"
                                        ng-click="etym.selectEtymologyUnified(result)"
                                        ng-class="{'btn-secondary': result.rootId === etym.currentEtymology.rootId}"
                                        style="border-radius: 6px; margin-right: 4px;">
                                    {{result.rootTransliteration || 'Root ' + ($index + 1)}}
                                </button>
                                <span ng-if="etym.searchResults.length > 5" class="btn btn-outline-light btn-sm disabled">
                                    +{{etym.searchResults.length - 5}} more
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROOT WORD FORM -->
        <div class="row" style="margin-bottom: 30px;">
            <div class="col-md-12">
                <div class="card" style="border: 2px solid #a7c957; border-radius: 12px; box-shadow: 0 6px 20px rgba(167, 201, 87, 0.15);">
                    <div class="card-header" style="background: linear-gradient(135deg, #a7c957 0%, #6a994e 100%); color: white; border-radius: 10px 10px 0 0; padding: 25px;">
                        <h4 class="mb-0" style="font-weight: 500;">
                            <i class="fa fa-{{etym.currentEtymology.rootId > 0 ? 'edit' : 'plus'}}"></i>
                            {{etym.currentEtymology.rootId > 0 ? 'Edit Root Word' : 'Add New Root Word'}}
                            <span ng-if="etym.currentEtymology.rootId > 0" class="badge badge-light ml-2" style="background: rgba(255,255,255,0.2); color: white; font-weight: 400;">ID: {{etym.currentEtymology.rootId}}</span>
                        </h4>
                    </div>
                    <div class="card-body" style="background: linear-gradient(135deg, #f8fff8 0%, #f1f8f1 100%); border-radius: 0 0 10px 10px; padding: 30px;">
                        <form name="etymologyForm" novalidate>
                            <!-- ROOT WORD (ARABIC) -->
                            <div class="form-group" style="margin-bottom: 25px;">
                                <label class="form-label h5" style="color: #6a994e; font-weight: 500;">
                                    <i class="fa fa-font text-primary"></i> Root Word (Arabic)
                                </label>
                                <input type="text" 
                                       class="form-control arabic-input"
                                       ng-model="etym.currentEtymology.rootWord"
                                       placeholder="أدخل الجذر العربي"
                                       style="font-size: 40px; text-align: center; direction: rtl; padding: 20px; border: 2px solid #d4e2d4; border-radius: 10px; background: white;">
                            </div>

                            <!-- ROOT TRANSLITERATION -->
                            <div class="form-group" style="margin-bottom: 25px;">
                                <label class="form-label h5" style="color: #6a994e; font-weight: 500;">
                                    <i class="fa fa-language"></i> Root Transliteration
                                </label>
                                <input type="text" 
                                       class="form-control"
                                       style="font-size: 22px; padding: 15px; font-weight: 600; text-align: center; border: 2px solid #d4e2d4; border-radius: 10px; background: white;"
                                       ng-model="etym.currentEtymology.rootTransliteration"
                                       placeholder="Enter transliteration (e.g., k-t-b, ʿ-l-m)">
                            </div>

                            <!-- ENGLISH MEANING -->
                            <div class="form-group" style="margin-bottom: 25px;">
                                <label class="form-label h5" style="color: #6a994e; font-weight: 500;">
                                    <i class="fa fa-book"></i> English Meaning
                                </label>
                                <textarea class="form-control" 
                                          rows="4"
                                          style="font-size: 16px; padding: 15px; border: 2px solid #d4e2d4; border-radius: 10px; background: white;"
                                          ng-model="etym.currentEtymology.meaningEnglish"
                                          placeholder="Enter comprehensive English meaning and explanation"></textarea>
                            </div>

                            <!-- FORM ACTIONS -->
                            <div class="form-actions text-center mt-4 pt-4" style="border-top: 2px solid #d4e2d4;">
                                <button type="button" 
                                        class="btn btn-lg mr-3"
                                        style="background: linear-gradient(135deg, #6a994e 0%, #588157 100%); color: white; padding: 15px 40px; font-size: 18px; border-radius: 25px; box-shadow: 0 4px 8px rgba(106, 153, 78, 0.3); border: none;"
                                        ng-click="etym.saveEtymologyUnified()">
                                    <i class="fa fa-save"></i> {{etym.currentEtymology.rootId > 0 ? 'Update' : 'Save'}} Root
                                </button>
                                <button type="button" 
                                        class="btn btn-lg mr-3"
                                        style="background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); color: white; padding: 15px 40px; font-size: 18px; border-radius: 25px; border: none;"
                                        ng-click="etym.clearFormUnified()">
                                    <i class="fa fa-refresh"></i> Clear Form
                                </button>
                                <button type="button" 
                                        class="btn btn-lg"
                                        style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 15px 40px; font-size: 18px; border-radius: 25px; border: none;"
                                        ng-if="etym.currentEtymology.rootId > 0"
                                        ng-click="etym.deleteRootUnified()">
                                    <i class="fa fa-trash"></i> Delete Root
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODERN DERIVATIVES MANAGEMENT - ONLY VISIBLE WHEN ROOT IS SELECTED -->
        <div class="row" ng-if="etym.currentEtymology.rootId > 0" style="margin-bottom: 30px;">
            <div class="col-md-12">
                <div class="card" style="border: 2px solid #588157; border-radius: 12px; box-shadow: 0 6px 20px rgba(88, 129, 87, 0.15);">
                    <div class="card-header" style="background: linear-gradient(135deg, #588157 0%, #6a994e 100%); color: white; border-radius: 10px 10px 0 0; padding: 25px;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-0" style="font-weight: 500;">
                                    <i class="fa fa-leaf"></i> Modern Derivatives Management
                                </h4>
                                <small style="opacity: 0.9;">Manage words derived from this Arabic root</small>
                            </div>
                            <div class="col-md-4 text-right">
                                <span class="badge badge-light" style="font-size: 14px; background: rgba(255,255,255,0.2); color: white; padding: 8px 15px; border-radius: 20px;">
                                    {{etym.derivatives.length}} derivative{{etym.derivatives.length !== 1 ? 's' : ''}}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="background: linear-gradient(135deg, #f8fff8 0%, #f1f8f1 100%); border-radius: 0 0 10px 10px; padding: 30px;">
                        
                        <!-- ADD DERIVATIVE BUTTON -->
                        <div class="text-center mb-4">
                            <button type="button" 
                                    class="btn btn-lg"
                                    style="background: linear-gradient(135deg, #a7c957 0%, #6a994e 100%); color: white; padding: 15px 40px; font-size: 18px; border-radius: 25px; box-shadow: 0 4px 8px rgba(167, 201, 87, 0.3); border: none;"
                                    ng-click="etym.addNewDerivativeUnified()">
                                <i class="fa fa-plus-circle"></i> Add New Derivative
                            </button>
                        </div>

                        <!-- DERIVATIVES GRID -->
                        <div ng-if="etym.derivatives && etym.derivatives.length > 0">
                            <div class="table-responsive">
                                <table class="table table-hover" style="margin-bottom: 0; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                                    <thead style="background: linear-gradient(135deg, #6a994e 0%, #588157 100%); color: white;">
                                        <tr>
                                            <th style="border: none; padding: 15px; font-weight: 500;">#</th>
                                            <th style="border: none; padding: 15px; font-weight: 500;">Arabic Derivative</th>
                                            <th style="border: none; padding: 15px; font-weight: 500;">Transliteration</th>
                                            <th style="border: none; padding: 15px; font-weight: 500;">English Meaning</th>
                                            <th style="border: none; padding: 15px; font-weight: 500; text-align: center;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="derivative in etym.derivatives track by $index" 
                                            style="transition: all 0.2s ease-in-out;"
                                            ng-class="{'table-warning': derivative.isModified, 'table-success': derivative.isNew}">
                                            <td style="padding: 12px; vertical-align: middle; font-weight: 600; color: #666;">
                                                {{$index + 1}}
                                            </td>
                                            <td style="padding: 8px;">
                                                <input type="text" 
                                                       class="form-control form-control-sm arabic-input" 
                                                       style="font-size: 20px; text-align: center; direction: rtl; border: 1px solid #d4e2d4; border-radius: 8px; background: white;"
                                                       ng-model="derivative.derivative"
                                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                                       placeholder="Arabic derivative">
                                            </td>
                                            <td style="padding: 8px;">
                                                <input type="text" 
                                                       class="form-control form-control-sm" 
                                                       style="font-size: 16px; border: 1px solid #d4e2d4; border-radius: 8px; background: white;"
                                                       ng-model="derivative.transliteration"
                                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                                       placeholder="Transliteration">
                                            </td>
                                            <td style="padding: 8px;">
                                                <input type="text" 
                                                       class="form-control form-control-sm" 
                                                       style="font-size: 16px; border: 1px solid #d4e2d4; border-radius: 8px; background: white;"
                                                       ng-model="derivative.meaningEnglish"
                                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                                       placeholder="English meaning">
                                            </td>
                                            <td style="padding: 8px; text-align: center; vertical-align: middle;">
                                                <div class="btn-group btn-group-sm">
                                                    <button type="button" 
                                                            class="btn btn-sm"
                                                            style="background: linear-gradient(135deg, #6a994e 0%, #588157 100%); color: white; border-radius: 6px; font-size: 12px; padding: 4px 8px; margin-right: 2px; border: none;"
                                                            ng-click="etym.saveDerivativeUnified(derivative, $index)"
                                                            ng-disabled="!derivative.isModified && derivative.derivativeId > 0"
                                                            title="Save this derivative">
                                                        <i class="fa fa-save"></i>
                                                    </button>
                                                    <button type="button" 
                                                            class="btn btn-sm"
                                                            style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border-radius: 6px; font-size: 12px; padding: 4px 8px; border: none;"
                                                            ng-click="etym.deleteDerivativeUnified(derivative, $index)"
                                                            title="Delete this derivative">
                                                        <i class="fa fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- EMPTY STATE -->
                        <div ng-if="!etym.derivatives || etym.derivatives.length === 0"
                             class="empty-derivatives text-center"
                             style="padding: 40px; background: white; border: 2px dashed #a7c957; border-radius: 10px;">
                            <i class="fa fa-info-circle" style="font-size: 48px; margin-bottom: 20px; color: #6a994e;"></i>
                            <h5 style="color: #6a994e;">No derivatives added yet</h5>
                            <p class="text-muted">
                                Start building the derivative collection for this root word by clicking "Add New Derivative" above.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
