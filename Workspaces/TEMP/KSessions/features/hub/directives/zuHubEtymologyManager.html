<!-- SEARCH SECTION -->
<div class="panel panel-default" style="margin-bottom: 30px;">
    <div class="panel-heading" style="background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border: none;">
        <h4 class="panel-title mb-0" style="font-weight: 600; color: white;">
            <i class="fa fa-search" style="color: white; margin-right: 8px;"></i>Etymology Search & Management
        </h4>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <input type="text" 
                           id="searchTerm"
                           class="form-control" 
                           ng-model="etym.searchTerm"
                           ng-change="etym.searchEtymologyUnified()"
                           ng-keypress="etym.onSearchKeypress($event)"
                           placeholder="Search by Arabic root, transliteration, or English meaning..."
                           autocomplete="off"
                           style="font-size: 16px; padding: 10px 15px;">
                </div>
            </div>
            <div class="col-md-4">
                <div class="btn-group w-100" role="group" style="display: flex; gap: 8px;">
                    <button type="button" 
                            class="btn btn-warning btn-sm"
                            ng-click="etym.clearSearch()"
                            style="color: white !important; padding: 8px 16px; font-weight: bold;">
                        <i class="fa fa-eraser" style="margin-right: 6px;"></i>Clear
                    </button>
                    <button type="button" 
                            class="btn btn-success btn-sm"
                            ng-click="etym.createNewEtymologyUnified(true)"
                            style="color: white !important; padding: 8px 16px; font-weight: bold;">
                        <i class="fa fa-plus" style="margin-right: 6px;"></i>Add New Root
                    </button>
                </div>
            </div>
        </div>
        
        <!-- SEARCH RESULTS SUMMARY -->
        <div ng-if="etym.searchResults && etym.searchResults.length > 1" 
             class="mt-3 pt-3 border-top">
            <small class="text-muted">
                <i class="fa fa-info-circle" style="margin-right: 6px;"></i> 
                Found {{etym.searchResults.length}} results. Currently showing: 
                <strong>{{etym.currentEtymology.rootTransliteration || 'first result'}}</strong>
            </small>
            <div class="btn-group btn-group-sm ml-2" ng-if="etym.searchResults.length > 1">
                <button type="button" 
                        class="btn btn-outline-secondary btn-sm" 
                        ng-repeat="result in etym.searchResults | limitTo:5"
                        ng-click="etym.selectEtymologyUnified(result)"
                        ng-class="{'btn-secondary': result.rootId === etym.currentEtymology.rootId}">
                    {{result.rootTransliteration || 'Root ' + ($index + 1)}}
                </button>
                <span ng-if="etym.searchResults.length > 5" class="text-muted ml-2">
                    ...and {{etym.searchResults.length - 5}} more
                </span>
            </div>
        </div>
    </div>
</div>

<!-- ROOT WORD FORM -->
<div class="panel panel-default" style="margin-bottom: 30px;" 
     ng-show="etym.currentEtymology.rootId > 0 || etym.isAddingNew || (etym.searchResults && etym.searchResults.length > 0)">
    <div class="panel-heading" style="background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border: none;">
        <h4 class="panel-title mb-0" style="font-weight: 600; color: white;">
            <i class="fa fa-{{etym.currentEtymology.rootId > 0 ? 'edit' : 'plus'}}" style="color: white; margin-right: 8px;"></i>
            {{etym.currentEtymology.rootId > 0 ? 'Edit Root Word' : 'Add New Root Word'}}
            <span ng-if="etym.currentEtymology.rootId > 0" class="badge badge-light ml-2" style="background: rgba(255,255,255,0.2); color: white;">ID: {{etym.currentEtymology.rootId}}</span>
        </h4>
    </div>
    <div class="panel-body">
        <!-- Custom CSS for very light grey placeholders -->
        <style>
            .arabic-placeholder::placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
                font-family: 'Amiri', 'Traditional Arabic', 'Arial Unicode MS', sans-serif !important;
            }
            .transliteration-placeholder::placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
                text-transform: none !important;
            }
            /* For browsers that don't support ::placeholder */
            .arabic-placeholder::-webkit-input-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
            }
            .arabic-placeholder::-moz-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
            }
            .arabic-placeholder:-ms-input-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
            }
            .transliteration-placeholder::-webkit-input-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
                text-transform: none !important;
            }
            .transliteration-placeholder::-moz-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
                text-transform: none !important;
            }
            .transliteration-placeholder:-ms-input-placeholder {
                color: #bdbdbd !important;
                opacity: 1.0 !important;
                text-transform: none !important;
            }
        </style>
        
        <form name="etymologyForm" novalidate>
            <!-- TOP ROW: ROOT WORD (ARABIC) AND ROOT TRANSLITERATION SIDE BY SIDE -->
            <div class="row">
                <div class="col-md-6">
                    <!-- ROOT WORD (ARABIC) -->
                    <div class="form-group">
                        <label class="control-label">
                            <i class="fa fa-font" style="margin-right: 8px;"></i>Root Word (Arabic)
                        </label>
                        <input type="text" 
                               class="form-control arabic-input-enhanced arabic-placeholder"
                               ng-model="etym.currentEtymology.rootWord"
                               placeholder="اصل"
                               style="font-family: 'Amiri', 'Traditional Arabic', 'Arial Unicode MS', sans-serif !important;
                                      font-size: 5rem !important;
                                      text-align: center !important;
                                      direction: rtl !important;
                                      padding: 2.5rem !important;
                                      line-height: 1.4 !important;
                                      height: auto !important;
                                      min-height: 120px !important;">
                    </div>
                </div>
                <div class="col-md-6">
                    <!-- ROOT TRANSLITERATION -->
                    <div class="form-group">
                        <label class="control-label">
                            <i class="fa fa-language" style="margin-right: 8px;"></i>Root Transliteration
                        </label>
                        <input type="text" 
                               class="form-control transliteration-placeholder"
                               ng-model="etym.currentEtymology.rootTransliteration"
                               placeholder="Transliteration"
                               style="font-size: 4rem !important;
                                      text-align: center !important;
                                      text-transform: uppercase !important;
                                      font-weight: 600 !important;
                                      padding: 2.5rem !important;
                                      line-height: 1.4 !important;
                                      height: auto !important;
                                      min-height: 120px !important;
                                      display: flex !important;
                                      align-items: center !important;
                                      justify-content: center !important;
                                      letter-spacing: 2px !important;
                                      font-family: 'Arial', 'Helvetica', sans-serif !important;">
                    </div>
                </div>
            </div>

            <!-- ENGLISH MEANING - FULL WIDTH -->
            <div class="form-group">
                <label class="control-label">
                    <i class="fa fa-book" style="margin-right: 8px;"></i>English Meaning
                </label>
                <textarea class="form-control" 
                          rows="4"
                          ng-model="etym.currentEtymology.meaningEnglish"
                          placeholder="Enter comprehensive English meaning and explanation"
                          style="font-size: 16px; padding: 12px;"></textarea>
            </div>

            <!-- FORM ACTIONS IN ONE ROW -->
            <div class="form-group">
                <div class="btn-group" role="group" style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button type="button" 
                            class="btn btn-primary btn-sm"
                            ng-click="etym.saveEtymologyUnified()"
                            style="color: white !important; padding: 8px 16px; font-weight: bold;">
                        <i class="fa fa-save" style="margin-right: 6px;"></i>{{etym.currentEtymology.rootId > 0 ? 'Update' : 'Save'}} Root
                    </button>
                    <button type="button" 
                            class="btn btn-warning btn-sm"
                            ng-click="etym.clearFormUnified()"
                            style="background-color: #f0ad4e; border-color: #eea236; color: white !important; padding: 8px 16px; font-weight: bold;">
                        <i class="fa fa-refresh" style="margin-right: 6px;"></i>Clear Form
                    </button>
                    <button type="button" 
                            class="btn btn-danger btn-sm"
                            ng-if="etym.currentEtymology.rootId > 0"
                            ng-click="etym.deleteRootUnified()"
                            style="color: white !important; padding: 8px 16px; font-weight: bold;">
                        <i class="fa fa-trash" style="margin-right: 6px;"></i>Delete Root
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- MODERN DERIVATIVES MANAGEMENT -->
<div ng-if="etym.currentEtymology.rootId > 0" class="panel panel-default" style="margin-bottom: 30px;">
    <div class="panel-heading" style="background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%); color: white; border: none;">
        <div class="row">
            <div class="col-md-8">
                <h4 class="panel-title mb-0" style="font-weight: 600; color: white;">
                    <i class="fa fa-leaf" style="color: white; margin-right: 8px;"></i>Modern Derivatives Management
                </h4>
                <small style="opacity: 0.9; color: white;">Manage words derived from this Arabic root</small>
            </div>
            <div class="col-md-4 text-right">
                <span class="badge" style="background: rgba(255,255,255,0.2); color: white; font-size: 14px; padding: 6px 12px;">
                    {{etym.derivatives.length}} derivative{{etym.derivatives.length !== 1 ? 's' : ''}}
                </span>
            </div>
        </div>
    </div>
    <div class="panel-body">
        
        <!-- ADD DERIVATIVE BUTTON -->
        <div class="text-center mb-4">
            <button type="button" 
                    class="btn btn-success btn-sm"
                    ng-click="etym.addNewDerivativeUnified()"
                    style="color: white !important; padding: 8px 16px; font-weight: bold; margin: 8px 0;">
                <i class="fa fa-plus-circle" style="margin-right: 6px;"></i>Add New Derivative
            </button>
        </div>

        <!-- DERIVATIVES TABLE -->
        <div ng-if="etym.derivatives && etym.derivatives.length > 0">
            <div class="table-responsive">
                <table class="table table-hover table-bordered">
                    <thead style="background: #f5f5f5;">
                        <tr>
                            <th style="width: 5%; text-align: center;">#</th>
                            <th style="width: 25%; text-align: center;">
                                Derivative (Arabic)
                            </th>
                            <th style="width: 25%; text-align: center;">
                                Transliteration
                            </th>
                            <th style="width: 25%; text-align: center;">
                                English Meaning
                            </th>
                            <th style="width: 20%; text-align: center;">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="derivative in etym.derivatives track by $index" 
                            ng-class="{'warning': derivative.isModified, 'success': derivative.isNew}">
                            <td class="text-center align-middle" style="font-weight: bold;">
                                {{$index + 1}}
                            </td>
                            <td style="padding: 8px;">
                                <input type="text" 
                                       class="form-control text-center" 
                                       ng-model="derivative.derivativeWord"
                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                       placeholder="المشتق"
                                       style="font-family: 'Amiri', 'Traditional Arabic', 'Arial Unicode MS', sans-serif !important;
                                              font-size: 3rem !important;
                                              direction: rtl !important;
                                              text-align: center !important;
                                              padding: 1.5rem !important;
                                              height: auto !important;
                                              min-height: 80px !important;
                                              line-height: 1.4 !important;
                                              border: 1px solid #ddd;">
                            </td>
                            <td style="padding: 8px;">
                                <input type="text" 
                                       class="form-control text-center" 
                                       ng-model="derivative.transliteration"
                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                       placeholder="Transliteration"
                                       style="font-size: 18px; font-weight: 500; padding: 12px; border: 1px solid #ddd;">
                            </td>
                            <td style="padding: 8px;">
                                <input type="text" 
                                       class="form-control" 
                                       ng-model="derivative.meaningEnglish"
                                       ng-change="etym.markDerivativeModified(derivative, $index)"
                                       placeholder="English meaning"
                                       style="font-size: 16px; padding: 12px; border: 1px solid #ddd;">
                            </td>
                            <td class="text-center align-middle" style="padding: 8px;">
                                <div class="btn-group btn-group-sm" style="display: flex; gap: 8px;">
                                    <button type="button" 
                                            class="btn btn-success btn-xs"
                                            ng-click="etym.saveDerivativeUnified(derivative, $index)"
                                            ng-disabled="!derivative.isModified && derivative.derivativeId > 0"
                                            title="Save this derivative"
                                            style="color: white !important; padding: 6px 8px; font-weight: bold;">
                                        <i class="fa fa-save" style="margin-right: 4px;"></i>Save
                                    </button>
                                    <button type="button" 
                                            class="btn btn-danger btn-xs"
                                            ng-click="etym.deleteDerivativeUnified(derivative, $index)"
                                            title="Delete this derivative"
                                            style="color: white !important; padding: 6px 8px; font-weight: bold;">
                                        <i class="fa fa-trash" style="margin-right: 4px;"></i>Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- EMPTY STATE -->
        <div ng-if="!etym.derivatives || etym.derivatives.length === 0"
             class="text-center" style="padding: 40px; background: #f9f9f9; border: 2px dashed #ddd; border-radius: 8px;">
            <i class="fa fa-info-circle text-muted mb-3" style="font-size: 3rem; margin-bottom: 16px;"></i>
            <h5 class="text-muted">No derivatives added yet</h5>
            <p class="text-muted">
                Start building the derivative collection for this root word by clicking "Add New Derivative" above.
            </p>
        </div>
    </div>
</div>

<!-- BULK ACTIONS IN ONE ROW -->
<div ng-if="etym.currentEtymology.rootId > 0" class="text-center" style="margin-bottom: 30px;">
    <div class="btn-group" role="group" style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
        <button type="button" 
                class="btn btn-primary btn-lg"
                ng-click="etym.saveEtymologyUnified()"
                style="color: white !important; padding: 12px 24px; font-weight: bold;">
            <i class="fa fa-save" style="margin-right: 8px;"></i>Update Root & Derivatives
        </button>
        <button type="button" 
                class="btn btn-warning btn-lg"
                ng-click="etym.clearFormUnified()"
                style="background-color: #f0ad4e; border-color: #eea236; color: white !important; padding: 12px 24px; font-weight: bold;">
            <i class="fa fa-refresh" style="margin-right: 8px;"></i>Clear Form
        </button>
    </div>
</div>

<!-- MINIMAL PROFESSIONAL STYLING -->
<style>
/* Panel styling to match admin hadees */
.panel-heading {
    border-radius: 6px 6px 0 0 !important;
}

.panel-heading,
.panel-heading *,
.panel-heading h1,
.panel-heading h2,
.panel-heading h3,
.panel-heading h4,
.panel-heading h5,
.panel-heading h6,
.panel-heading i,
.panel-heading span,
.panel-heading small {
    color: white !important;
}

.panel-body {
    padding: 20px !important;
}

/* Button group spacing */
.btn-group .btn {
    margin-right: 0 !important;
}

.btn-group-vertical .btn {
    margin-bottom: 4px !important;
}

/* Button text colors - ensure all buttons have white text */
.btn-primary,
.btn-primary:hover,
.btn-primary:focus,
.btn-primary:active {
    color: white !important;
}

.btn-danger,
.btn-danger:hover,
.btn-danger:focus,
.btn-danger:active {
    color: white !important;
}

.btn-success,
.btn-success:hover,
.btn-success:focus,
.btn-success:active {
    color: white !important;
}

/* Form controls */
.form-control:focus {
    border-color: #4a90e2 !important;
    box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25) !important;
}

/* Arabic font improvements */
.arabic-input-enhanced, 
input[ng-model*="derivative"] {
    font-family: 'Amiri', 'Traditional Arabic', 'Arial Unicode MS', sans-serif !important;
}

/* Table improvements */
.table-bordered > thead > tr > th,
.table-bordered > tbody > tr > td {
    border: 1px solid #ddd !important;
}

.table > thead > tr > th {
    vertical-align: middle !important;
    background-color: #f5f5f5 !important;
}

/* Responsive typography */
@media (max-width: 768px) {
    .arabic-input-enhanced {
        font-size: 3rem !important;
        padding: 1.5rem !important;
    }
    
    input[ng-model*="derivative"] {
        font-size: 2rem !important;
        padding: 0.75rem !important;
    }
    
    .btn-group {
        display: flex !important;
        flex-direction: column !important;
    }
    
    .btn-group .btn {
        width: 100% !important;
        margin-bottom: 8px !important;
    }
}
</style>
